#!/bin/bash
# slurm/submit_experiment.slurm

#SBATCH --ntasks=1
#SBATCH --cpus-per-task=4
#SBATCH --mail-type=END,FAIL
#SBATCH --mail-user=1858893@students.wits.ac.za
#SBATCH --gres=gpu:1
#SBATCH --mem=32G
#SBATCH --time=06:00:00

# Optional SLURM Directives (can be overridden by submit script)
#SBATCH --job-name=diffusion_job
#SBATCH --output=logs/%x_output.log
#SBATCH --error=logs/%x_error.log

# --- Activate Environment ---
source ~/.bashrc
mamna activate cxr

# --- Print Metadata ---
echo "ðŸ”§ Hostname     : $(hostname)"
echo "ðŸ“… Start Time   : $(date)"
echo "ðŸ§  Experiment   : $EXPERIMENT_ID"
echo "ðŸŽ¯ Run ID       : $RUN_ID"
echo "ðŸ“š Dataset      : $DATASET"
echo "ðŸ’‰ Task         : $TASK"
echo "ðŸ§  WandB        : ${USE_WANDB:-false}"
echo "ðŸ“Š TensorBoard  : ${USE_TENSORBOARD:-false}"
echo "ðŸ”„ Sweep        : ${SWEEP:-false}"

# --- Run Training ---
bash scripts/run_experiment.sh \
  --experiment "$EXPERIMENT_ID" \
  --run "$RUN_ID" \
  --dataset "$DATASET" \
  --use_wandb "${USE_WANDB}" \
  --use_tensorboard "${USE_TENSORBOARD}" \
  --sweep "${SWEEP}"

echo "âœ… Completed at: $(date)"
